<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mihai Ion - L14: Conditional stats applied</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Mihai Ion</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../teaching.html" rel="" target="" aria-current="page">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../CV/Mihai Ion CV.pdf" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">FIN 525</li><li class="breadcrumb-item"><a href="../../../teaching/FIN 525/lectures/lecture00_Jupyter_Basics.html">Lectures</a></li><li class="breadcrumb-item"><a href="../../../teaching/FIN 525/lectures/lecture14_conditional_stats_applied.html">L14: Conditional stats applied</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Teaching</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">FIN 525</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture00_Jupyter_Basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L00: Jupyter basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture01_Introduction_and_Setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L01: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture02_codeExecution_variables_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L02: Variables, types, operators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture03_Data_Structures_Dot_Notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L03: Data structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture04_Conditional_Statements_and_Iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L04: Conditionals, loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture05_Functions_and_Packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L05: Functions, packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture06_pandas_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L06: Pandas intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture07_data_input_output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L07: Pandas I/O</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture08_filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L08: Pandas filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture09_data_cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L09: Pandas data cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture10_merging_reshaping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L10: Merging, reshaping datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture11_Dates_Lags_Sorting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L11: Dates, lags, sorting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture12_descriptive_stats_unconditional.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L12: Descriptive stats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture13_wins_groupby_apply_transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L13: Conditional stats, outliers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture14_conditional_stats_applied.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">L14: Conditional stats applied</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture15_regression_intro1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L15: Linear regression intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture16_regression_intro2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L16: Linear regression applications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture17_regression_application_panel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L17: Panel regression intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture18_robust_panel_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L18: Robust panel regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture19_regression_application_timeseries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L19: Robust timeseries regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture20_backtesting_dataprep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L20: Backtesting - data prep</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture21_sortvar_sumstats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L21: Backtesting - sumstats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture22_portfolio_returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L22: Backtesting -returns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 525/lectures/lecture23_riskadjusted_ret.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L23: Backtesting - risk adjustment</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">FIN 421</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L01_Introduction_and_Setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L01: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L02_Foundations_1_Past_Returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L02: Analyzing past returns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L03_Foundations_2_Future_Returns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L03: Modeling future returns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L04_Portfolio_Theory_1_Mechanics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L04: Portfolio theory intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L05_Portfolio_Theory_2_Optimal_Capital_Allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L05: Optimal capital allocation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L06_Portfolio_Theory_3_Tangency_Portfolios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L06: Tangency portfolios</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L07_08_Portfolio_Theory_4_Optimal_Asset_Allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L07_08: Optimal asset allocation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/L09_Review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L09: Review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 10 11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L10_11: Statistical models of returns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L12: CAPM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L13: Cost of equity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L14: Bond pricing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L15: Bond yields</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L16: Bond risk</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 17 Data Processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L17: Valuation data processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 18 and 19 on Multiples Valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L18_19: Multiples valuation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 20 and 21 on DDM Valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L20_21: Dividend discount models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 22 and 23 on DCF Valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L22_23: Discounted cash flow analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 24 Sensitivity Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L24: Valuation sensitivity analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 25 Option Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L25: Options intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../teaching/FIN 421/lectures/Lecture 26 on Option Strategies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">L26: Risk management with options</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lecture-overview" id="toc-lecture-overview" class="nav-link active" data-scroll-target="#lecture-overview">Lecture overview</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#subperiod-analysis" id="toc-subperiod-analysis" class="nav-link" data-scroll-target="#subperiod-analysis">Subperiod analysis</a></li>
  <li><a href="#conditioning-on-cross-sectional-information" id="toc-conditioning-on-cross-sectional-information" class="nav-link" data-scroll-target="#conditioning-on-cross-sectional-information">Conditioning on cross-sectional information</a></li>
  <li><a href="#conditioning-on-both-time-and-the-cross-section" id="toc-conditioning-on-both-time-and-the-cross-section" class="nav-link" data-scroll-target="#conditioning-on-both-time-and-the-cross-section">Conditioning on both time and the cross-section</a></li>
  <li><a href="#advanced-binning-example" id="toc-advanced-binning-example" class="nav-link" data-scroll-target="#advanced-binning-example">Advanced “binning” example</a>
  <ul class="collapse">
  <li><a href="#multi-dimensional-bins" id="toc-multi-dimensional-bins" class="nav-link" data-scroll-target="#multi-dimensional-bins">Multi-dimensional bins</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">L14: Conditional stats applied</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="lecture-overview" class="level1">
<h1>Lecture overview</h1>
<p>Loosely speaking, “conditional descriptive statistics” are statistics calculated for subsamples (subsets) of your data. The information you use to create these subsamples is referred to as the “conditioning information”. In this lecture, we showcase these types of descriptive statistics using the tools learned in the previous lecture, and a panel dataset: the “compa” file, which contains accounting information for multiple firms over multiple years.</p>
<p>In the previous lecture we calculated conditional statistics in situations where the variable which dictated what observations are in what subsample already exists in the dataset. For example, we calculated average returns for each industry separately. In that example, the returns of each individual industry constitute a separate subsample of our data. The “conditioning information” which allowed us to specify which observation was in what sample was the “Industry” variable (which already existed in the dataset).</p>
<p>In this lecture, we will focus on examples where we have to create ourselves the variable which specifies which observation is in what sample.</p>
</section>
<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get raw data:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>comp_raw <span class="op">=</span> pd.read_pickle(<span class="st">'../data/compa.zip'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>comp_raw.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>permno      float64
datadate     object
gvkey        object
tic          object
conm         object
at          float64
capx        float64
che         float64
cogs        float64
csho        float64
dlc         float64
dltt        float64
dp          float64
dvc         float64
ib          float64
oancf       float64
ppegt       float64
ppent       float64
revt        float64
sale        float64
fic          object
prcc_f      float64
sich        float64
dtype: object</code></pre>
</div>
</div>
<p>Clean it up a bit:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by firm identifier and date</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>comp_raw.sort_values([<span class="st">'permno'</span>,<span class="st">'datadate'</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract year from the date</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>comp_raw[<span class="st">'year'</span>] <span class="op">=</span> pd.to_datetime(comp_raw[<span class="st">'datadate'</span>]).dt.year</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>comp_raw.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">permno</th>
<th data-quarto-table-cell-role="th">datadate</th>
<th data-quarto-table-cell-role="th">gvkey</th>
<th data-quarto-table-cell-role="th">tic</th>
<th data-quarto-table-cell-role="th">conm</th>
<th data-quarto-table-cell-role="th">at</th>
<th data-quarto-table-cell-role="th">capx</th>
<th data-quarto-table-cell-role="th">che</th>
<th data-quarto-table-cell-role="th">cogs</th>
<th data-quarto-table-cell-role="th">csho</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">ib</th>
<th data-quarto-table-cell-role="th">oancf</th>
<th data-quarto-table-cell-role="th">ppegt</th>
<th data-quarto-table-cell-role="th">ppent</th>
<th data-quarto-table-cell-role="th">revt</th>
<th data-quarto-table-cell-role="th">sale</th>
<th data-quarto-table-cell-role="th">fic</th>
<th data-quarto-table-cell-role="th">prcc_f</th>
<th data-quarto-table-cell-role="th">sich</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">188730</td>
<td>10000.0</td>
<td>1986-10-31</td>
<td>013007</td>
<td>OMFGA</td>
<td>OPTIMUM MANUFACTURING -CL A</td>
<td>2.115</td>
<td>0.240</td>
<td>0.348</td>
<td>0.511</td>
<td>3.843</td>
<td>...</td>
<td>-0.730</td>
<td>NaN</td>
<td>0.328</td>
<td>0.189</td>
<td>1.026</td>
<td>1.026</td>
<td>USA</td>
<td>0.75</td>
<td>NaN</td>
<td>1986</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188550</td>
<td>10001.0</td>
<td>1986-06-30</td>
<td>012994</td>
<td>EGAS</td>
<td>GAS NATURAL INC</td>
<td>12.242</td>
<td>0.551</td>
<td>0.746</td>
<td>19.565</td>
<td>0.985</td>
<td>...</td>
<td>0.669</td>
<td>NaN</td>
<td>13.021</td>
<td>8.216</td>
<td>21.460</td>
<td>21.460</td>
<td>USA</td>
<td>6.00</td>
<td>NaN</td>
<td>1986</td>
</tr>
</tbody>
</table>

<p>2 rows × 24 columns</p>
</div>
</div>
</div>
<p>Create a new dataframe with firm and year identifiers for firms with positive total assets:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>comp <span class="op">=</span> comp_raw.loc[comp_raw[<span class="st">'at'</span>]<span class="op">&gt;</span><span class="dv">0</span>, [<span class="st">'permno'</span>,<span class="st">'year'</span>, <span class="st">'sich'</span>]].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And calculate some key variables:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'inv'</span>] <span class="op">=</span> comp_raw[<span class="st">'capx'</span>] <span class="op">/</span> comp_raw[<span class="st">'at'</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'roa'</span>] <span class="op">=</span> comp_raw[<span class="st">'ib'</span>] <span class="op">/</span> comp_raw[<span class="st">'at'</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'lev'</span>] <span class="op">=</span> (comp_raw[<span class="st">'dlc'</span>] <span class="op">+</span> comp_raw[<span class="st">'dltt'</span>]) <span class="op">/</span> comp_raw[<span class="st">'at'</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'cash'</span>] <span class="op">=</span> comp_raw[<span class="st">'che'</span>] <span class="op">/</span> comp_raw[<span class="st">'at'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>comp.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">permno</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">sich</th>
<th data-quarto-table-cell-role="th">inv</th>
<th data-quarto-table-cell-role="th">roa</th>
<th data-quarto-table-cell-role="th">lev</th>
<th data-quarto-table-cell-role="th">cash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>237017.000000</td>
<td>237017.000000</td>
<td>192174.000000</td>
<td>221486.000000</td>
<td>236472.000000</td>
<td>235458.000000</td>
<td>236417.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>59908.145365</td>
<td>1999.543877</td>
<td>4734.864368</td>
<td>0.060206</td>
<td>-0.056431</td>
<td>0.243002</td>
<td>0.174782</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>28075.843586</td>
<td>11.096752</td>
<td>1986.202863</td>
<td>0.111862</td>
<td>1.494764</td>
<td>0.313886</td>
<td>0.219955</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>10000.000000</td>
<td>1980.000000</td>
<td>100.000000</td>
<td>-2.093398</td>
<td>-218.000000</td>
<td>-0.050045</td>
<td>-0.069190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>33420.000000</td>
<td>1991.000000</td>
<td>3320.000000</td>
<td>0.011996</td>
<td>-0.032695</td>
<td>0.042258</td>
<td>0.025310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>75049.000000</td>
<td>1999.000000</td>
<td>4581.000000</td>
<td>0.035232</td>
<td>0.018931</td>
<td>0.191382</td>
<td>0.080652</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>83492.000000</td>
<td>2008.000000</td>
<td>6321.000000</td>
<td>0.075212</td>
<td>0.061761</td>
<td>0.369135</td>
<td>0.234988</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>93436.000000</td>
<td>2020.000000</td>
<td>9998.000000</td>
<td>31.000000</td>
<td>226.310379</td>
<td>39.592899</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Challenge</strong></p>
<p>Winsorize the ‘inv’,‘roa’,‘lev’,‘cash’ variables at the 1 and 99th percentiles and get full-sample summary statistics for them.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> [<span class="st">'inv'</span>,<span class="st">'roa'</span>,<span class="st">'lev'</span>,<span class="st">'cash'</span>]:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    comp[<span class="ss">f'w_</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> comp[var].clip(lower<span class="op">=</span>comp[var].quantile(<span class="fl">0.01</span>), </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                    upper<span class="op">=</span>comp[var].quantile(<span class="fl">0.99</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>comp.<span class="bu">filter</span>(like<span class="op">=</span><span class="st">'w_'</span>).agg([<span class="st">'mean'</span>,<span class="st">'std'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">w_inv</th>
<th data-quarto-table-cell-role="th">w_roa</th>
<th data-quarto-table-cell-role="th">w_lev</th>
<th data-quarto-table-cell-role="th">w_cash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.058342</td>
<td>-0.046949</td>
<td>0.236951</td>
<td>0.174446</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>0.072156</td>
<td>0.257251</td>
<td>0.221142</td>
<td>0.218750</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Compare the standard deviations of the winsorized variables above, to the standard deviation of the un-wisnorized variables:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>comp[[<span class="st">'inv'</span>,<span class="st">'roa'</span>,<span class="st">'lev'</span>,<span class="st">'cash'</span>]].agg([<span class="st">'mean'</span>,<span class="st">'std'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">inv</th>
<th data-quarto-table-cell-role="th">roa</th>
<th data-quarto-table-cell-role="th">lev</th>
<th data-quarto-table-cell-role="th">cash</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.060206</td>
<td>-0.056431</td>
<td>0.243002</td>
<td>0.174782</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>0.111862</td>
<td>1.494764</td>
<td>0.313886</td>
<td>0.219955</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Save the names of the main variables we want to analyze into a list, so we don’t have to type them up every time we use them:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>main_vars <span class="op">=</span> [ <span class="st">'w_inv'</span>,<span class="st">'w_roa'</span>,<span class="st">'w_lev'</span>,<span class="st">'w_cash'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="subperiod-analysis" class="level1">
<h1>Subperiod analysis</h1>
<p>It is often a good idea to test how the results of your analysis change depending on the time period included in the data. This type of testing is generally referred to as “subperiod analysis”. We’ll cover two such examples below.</p>
<p>In the following example, we calculate means of our key variables <strong>each year</strong> and plot these means to see how they have changed over time.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>annual_means <span class="op">=</span> comp.groupby(<span class="st">'year'</span>)[main_vars].mean()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>annual_means.plot(figsize <span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As another example, we now calculate our means separately for the period prior to the year 2000, and the period after.</p>
<p>To do this, we need to create a new variable in our dataframe that takes one value prior to 2000 and a different value after 2000. <em>What</em> these values are, does not matter at all, they just have to be two different values in the pre-2000 and post-2000 eras. An easy way to do this is with the <code>where</code> function in the <code>numpy</code> package. This function works exactly like <code>if</code> in Excel:</p>
<p>Syntax:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>numpy.where(condition, x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When the condition is true, this returns the value x, and when it is false, it returns the value y.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The long way:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#comp['pre_post_2000'] = 'pre_2000'</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#comp.loc[comp['year'] &gt;= 2000, 'pre_post_2000'] = 'post_2000'</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># With "np.where"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'pre_post_2000'</span>] <span class="op">=</span> np.where(comp[<span class="st">'year'</span>]<span class="op">&lt;</span><span class="dv">2000</span>, <span class="st">'pre_2000'</span>, <span class="st">'post_2000'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>comp[[<span class="st">'year'</span>,<span class="st">'pre_post_2000'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">pre_post_2000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">188730</td>
<td>1986</td>
<td>pre_2000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188550</td>
<td>1986</td>
<td>pre_2000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188566</td>
<td>1987</td>
<td>pre_2000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188567</td>
<td>1988</td>
<td>pre_2000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188568</td>
<td>1989</td>
<td>pre_2000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493016</td>
<td>2016</td>
<td>post_2000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493017</td>
<td>2017</td>
<td>post_2000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493020</td>
<td>2018</td>
<td>post_2000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493021</td>
<td>2019</td>
<td>post_2000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493024</td>
<td>2020</td>
<td>post_2000</td>
</tr>
</tbody>
</table>

<p>237017 rows × 2 columns</p>
</div>
</div>
</div>
<p>We can now use the “pre_post_2000” variable with <code>.groupby()</code> to calculate means separately in the two subperiods:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>comp.groupby(<span class="st">'pre_post_2000'</span>)[main_vars].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">w_inv</th>
<th data-quarto-table-cell-role="th">w_roa</th>
<th data-quarto-table-cell-role="th">w_lev</th>
<th data-quarto-table-cell-role="th">w_cash</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">pre_post_2000</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">post_2000</td>
<td>0.042663</td>
<td>-0.059010</td>
<td>0.227570</td>
<td>0.201954</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pre_2000</td>
<td>0.073641</td>
<td>-0.035868</td>
<td>0.245604</td>
<td>0.149072</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conditioning-on-cross-sectional-information" class="level1">
<h1>Conditioning on cross-sectional information</h1>
<p>Our panel dataset has information for many different firms, each year. We refer to the totality of the firms in our sample as the “cross-sectional” dimension of the data (as opposed to the “time” dimension).</p>
<p>In the examples below, we calculate means of our key variables for each sector in the economy. For each sector, we use all the data available for that sector (i.e.&nbsp;all years for all firms in that sector). This means we will have a single mean per sector.</p>
<p>In our example, separate “sectors” are identified by the first digit of the SIC (industry) code of the firm (the “sich” variable in the “comp” dataframe). So this is another example in which we have to create a new variable that specifies which observation is in which subsample (sector).</p>
<p>We do this by first turning “sich” into a string variable (with <code>.astype('string')</code>) and then selecting the first character in that string (with <code>.str[0]</code>):</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'sic1d'</span>] <span class="op">=</span> np.floor(comp[<span class="st">'sich'</span>]<span class="op">/</span><span class="dv">1000</span>).astype(<span class="st">'string'</span>).<span class="bu">str</span>[<span class="dv">0</span>] </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>comp[[<span class="st">'sich'</span>,<span class="st">'sic1d'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sich</th>
<th data-quarto-table-cell-role="th">sic1d</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">188730</td>
<td>NaN</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188550</td>
<td>NaN</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188566</td>
<td>4924.0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188567</td>
<td>4924.0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188568</td>
<td>4924.0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493016</td>
<td>3711.0</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493017</td>
<td>3711.0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493020</td>
<td>3711.0</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493021</td>
<td>3711.0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493024</td>
<td>3711.0</td>
<td>3</td>
</tr>
</tbody>
</table>

<p>237017 rows × 2 columns</p>
</div>
</div>
</div>
<p>Let’s see how many observations we have for each sector:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'sic1d'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>3    48362
6    33072
2    30046
7    23427
5    17683
4    17545
1    12737
8     7715
9      923
0      664
Name: sic1d, dtype: Int64</code></pre>
</div>
</div>
<p>If you look up the SIC codes:</p>
<p>https://siccode.com/sic-code-lookup-directory</p>
<p>you’ll see that, roughly speaking, 3 stands for manufacturing firms (though 2 does as well), and 6 stands for financial firms. So the two largest sectors represented in our sample are manufacturing and finance.</p>
<p>Finally, we calculate sector-level means for each of the main variables, using “sic1d” with the <code>groupby</code> function. Note how much these statistics differ across sectors:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ind_means <span class="op">=</span> comp.groupby(<span class="st">'sic1d'</span>)[main_vars].mean()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ind_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">w_inv</th>
<th data-quarto-table-cell-role="th">w_roa</th>
<th data-quarto-table-cell-role="th">w_lev</th>
<th data-quarto-table-cell-role="th">w_cash</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sic1d</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.059727</td>
<td>-0.020970</td>
<td>0.277227</td>
<td>0.115660</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.126561</td>
<td>-0.056219</td>
<td>0.263007</td>
<td>0.116430</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.046453</td>
<td>-0.146969</td>
<td>0.229444</td>
<td>0.290379</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.047486</td>
<td>-0.055418</td>
<td>0.197940</td>
<td>0.203723</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.083914</td>
<td>-0.010957</td>
<td>0.371167</td>
<td>0.091903</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.065671</td>
<td>-0.003676</td>
<td>0.259566</td>
<td>0.105802</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.010060</td>
<td>0.010051</td>
<td>0.242219</td>
<td>0.117255</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.053990</td>
<td>-0.093262</td>
<td>0.194325</td>
<td>0.272838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.052362</td>
<td>-0.066628</td>
<td>0.233897</td>
<td>0.211465</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.012501</td>
<td>-0.062985</td>
<td>0.094941</td>
<td>0.237630</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conditioning-on-both-time-and-the-cross-section" class="level1">
<h1>Conditioning on both time and the cross-section</h1>
<p>Finally, we showcase an example where we examine how summary statistics vary across groups of firms <strong>and</strong> over time.</p>
<p>In the example below, we calculate means of our key variables for each sector in the economy, for each year separately. For each sector, we take an average over all the firms in that sector, separately for each year that the sector exists in our dataset. This means we will have a time-series of means for each sector.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ind_anmeans <span class="op">=</span> comp.groupby([<span class="st">'year'</span>,<span class="st">'sic1d'</span>])[main_vars].mean()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ind_anmeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">w_inv</th>
<th data-quarto-table-cell-role="th">w_roa</th>
<th data-quarto-table-cell-role="th">w_lev</th>
<th data-quarto-table-cell-role="th">w_cash</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">sic1d</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">1982</td>
<td data-quarto-table-cell-role="th">1</td>
<td>0.000000</td>
<td>-0.021536</td>
<td>0.222899</td>
<td>0.027818</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>0.020324</td>
<td>0.022094</td>
<td>0.226803</td>
<td>0.107758</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">1983</td>
<td data-quarto-table-cell-role="th">1</td>
<td>0.002262</td>
<td>0.018584</td>
<td>0.145025</td>
<td>0.118914</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>0.015431</td>
<td>0.022255</td>
<td>0.210558</td>
<td>0.107978</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1984</td>
<td data-quarto-table-cell-role="th">1</td>
<td>0.003433</td>
<td>0.028340</td>
<td>0.170928</td>
<td>0.071714</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2020</td>
<td data-quarto-table-cell-role="th">5</td>
<td>0.031845</td>
<td>-0.017026</td>
<td>0.412766</td>
<td>0.143202</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>0.004374</td>
<td>0.003683</td>
<td>0.249704</td>
<td>0.127982</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>0.023156</td>
<td>-0.086181</td>
<td>0.296805</td>
<td>0.302491</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.020325</td>
<td>-0.053079</td>
<td>0.295074</td>
<td>0.240811</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>0.001519</td>
<td>-0.055441</td>
<td>0.032119</td>
<td>0.013138</td>
</tr>
</tbody>
</table>

<p>358 rows × 4 columns</p>
</div>
</div>
</div>
<p>We now plot some of these sector-specific means to see how they have changed over time. To create these plots, we use the <strong>unstack</strong> function to unstack the industries so their data show up side by side (instead of on top of each other).</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked <span class="op">=</span> ind_anmeans.unstack(<span class="st">'sic1d'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">w_inv</th>
<th data-quarto-table-cell-role="th">...</th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">w_cash</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sic1d</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1982</td>
<td>NaN</td>
<td>0.000000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.020324</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>0.027818</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.107758</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1983</td>
<td>NaN</td>
<td>0.002262</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.015431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>0.118914</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.107978</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1984</td>
<td>NaN</td>
<td>0.003433</td>
<td>0.112669</td>
<td>0.050054</td>
<td>NaN</td>
<td>NaN</td>
<td>0.013060</td>
<td>0.107678</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>0.071714</td>
<td>0.001780</td>
<td>0.011730</td>
<td>NaN</td>
<td>NaN</td>
<td>0.107901</td>
<td>0.327153</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1985</td>
<td>NaN</td>
<td>NaN</td>
<td>0.086889</td>
<td>0.043671</td>
<td>NaN</td>
<td>NaN</td>
<td>0.015411</td>
<td>0.140073</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>0.018878</td>
<td>0.040591</td>
<td>NaN</td>
<td>NaN</td>
<td>0.108129</td>
<td>0.189906</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1986</td>
<td>NaN</td>
<td>NaN</td>
<td>0.025808</td>
<td>0.035173</td>
<td>0.022611</td>
<td>NaN</td>
<td>0.010504</td>
<td>0.115635</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>0.002797</td>
<td>0.213266</td>
<td>0.041357</td>
<td>NaN</td>
<td>0.104898</td>
<td>0.428892</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 40 columns</p>
</div>
</div>
</div>
<p>Note that the column labels have two components: one component that tells us which variable is being summarized, and one component that tells us which sector is being summarized:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>MultiIndex([( 'w_inv', '0'),
            ( 'w_inv', '1'),
            ( 'w_inv', '2'),
            ( 'w_inv', '3'),
            ( 'w_inv', '4'),
            ( 'w_inv', '5'),
            ( 'w_inv', '6'),
            ( 'w_inv', '7'),
            ( 'w_inv', '8'),
            ( 'w_inv', '9'),
            ( 'w_roa', '0'),
            ( 'w_roa', '1'),
            ( 'w_roa', '2'),
            ( 'w_roa', '3'),
            ( 'w_roa', '4'),
            ( 'w_roa', '5'),
            ( 'w_roa', '6'),
            ( 'w_roa', '7'),
            ( 'w_roa', '8'),
            ( 'w_roa', '9'),
            ( 'w_lev', '0'),
            ( 'w_lev', '1'),
            ( 'w_lev', '2'),
            ( 'w_lev', '3'),
            ( 'w_lev', '4'),
            ( 'w_lev', '5'),
            ( 'w_lev', '6'),
            ( 'w_lev', '7'),
            ( 'w_lev', '8'),
            ( 'w_lev', '9'),
            ('w_cash', '0'),
            ('w_cash', '1'),
            ('w_cash', '2'),
            ('w_cash', '3'),
            ('w_cash', '4'),
            ('w_cash', '5'),
            ('w_cash', '6'),
            ('w_cash', '7'),
            ('w_cash', '8'),
            ('w_cash', '9')],
           names=[None, 'sic1d'])</code></pre>
</div>
</div>
<p>Let’s look at the evolution of investment in particular:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked[<span class="st">'w_inv'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">sic1d</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1982</td>
<td>NaN</td>
<td>0.000000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.020324</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1983</td>
<td>NaN</td>
<td>0.002262</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.015431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1984</td>
<td>NaN</td>
<td>0.003433</td>
<td>0.112669</td>
<td>0.050054</td>
<td>NaN</td>
<td>NaN</td>
<td>0.013060</td>
<td>0.107678</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1985</td>
<td>NaN</td>
<td>NaN</td>
<td>0.086889</td>
<td>0.043671</td>
<td>NaN</td>
<td>NaN</td>
<td>0.015411</td>
<td>0.140073</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1986</td>
<td>NaN</td>
<td>NaN</td>
<td>0.025808</td>
<td>0.035173</td>
<td>0.022611</td>
<td>NaN</td>
<td>0.010504</td>
<td>0.115635</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that the column names are actually strings, not integers:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked[<span class="st">'w_inv'</span>].columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>Index(['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'], dtype='string', name='sic1d')</code></pre>
</div>
</div>
<p>Note also that in the first few years, we have lots of missing data for the ‘sich’ variable, which is why we have so many “NaN” values in the table above. We use <code>.dropna()</code> to eliminate all the years in which we have “NaN” values:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked[<span class="st">'w_inv'</span>].dropna().plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Sector 1 is “Mining and Construction” and Sector 6 is “Financials” so it makes sense that they have drastically different levels of physical investment. To plot just those two sectors, we have to use <code>.loc[]</code> to extract them from the overall dataframe before we use <code>.plot()</code>:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked[<span class="st">'w_inv'</span>].loc[:,[<span class="st">'1'</span>,<span class="st">'6'</span>]].dropna().plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>To test yourself, see if you can tell why the line below produces the same result:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked.loc[:, [(<span class="st">'w_inv'</span>,<span class="st">'1'</span>), (<span class="st">'w_inv'</span>,<span class="st">'6'</span>)]].dropna().plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Challange</strong>:</p>
<p>Create a similar plot to the one above, but this time for profitability (roa). Also, this time, place each sector (1 and 6) in a separate subplot.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ind_means_unstacked[<span class="st">'w_roa'</span>].loc[:,[<span class="st">'1'</span>,<span class="st">'6'</span>]].dropna().plot(subplots<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="advanced-binning-example" class="level1">
<h1>Advanced “binning” example</h1>
<p>In many cases, our analysis requires us to split our sample in bins (groups) based on how firms rank in terms of one specific variable. Then some analysis is performed separately for each bin.</p>
<p>To showcase this type of subsample analysis, in the examples below, we analyze if the evolution of cash holdings over time looks different for firms with different levels of profitability.</p>
<p>To do this, we need to define what we mean by “different levels of profitability”. One approach could be to use specific values of profitability: e.g.&nbsp;put all firms with ROA larger than 20% in a “high profitability” bin, etc. However, these levels would be a bit arbitrary (why 20% and not 25%).</p>
<p>Instead, a more common approach is to simply split firms into a number of equaly sized bins (same number of firms in each bin). For example, below, we split firms into 5 equaly-sized “bins” based on how their profitability ranks among the rest of profitability data (5 equaly-size groups are often called “quintiles”, 4 = “quartiles”, 3 = “terciles, 10 =”deciles”)</p>
<p>First, let’s look again at how average cash-holdings evolve over time, when we use the full cross-section:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>comp.groupby(<span class="st">'year'</span>)[<span class="st">'w_cash'</span>].mean().plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now we can use the <code>.qcut()</code> function to create the 5 profitability bins.</p>
<p>Syntax:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pandas.qcut(x, q, labels<span class="op">=</span><span class="va">None</span>, retbins<span class="op">=</span><span class="va">False</span>, precision<span class="op">=</span><span class="dv">3</span>, duplicates<span class="op">=</span><span class="st">'raise'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'roa_quintile'</span>] <span class="op">=</span> pd.qcut(comp[<span class="st">'roa'</span>], q <span class="op">=</span> <span class="dv">5</span>, labels <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>comp[[<span class="st">'roa'</span>, <span class="st">'roa_quintile'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">roa</th>
<th data-quarto-table-cell-role="th">roa_quintile</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">188730</td>
<td>-0.345154</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188550</td>
<td>0.054648</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188566</td>
<td>0.026506</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188567</td>
<td>0.046187</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188568</td>
<td>0.065069</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493016</td>
<td>-0.029779</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493017</td>
<td>-0.068448</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493020</td>
<td>-0.032821</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493021</td>
<td>-0.025125</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493024</td>
<td>0.013826</td>
<td>3</td>
</tr>
</tbody>
</table>

<p>237017 rows × 2 columns</p>
</div>
</div>
</div>
<p>And check that these are “equally-sized bins”:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'roa_quintile'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>1    47295
5    47295
2    47294
3    47294
4    47294
Name: roa_quintile, dtype: int64</code></pre>
</div>
</div>
<p>Now take a look at the trends in cash holdings, separately, for firm in different ROA bins:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>qmeans <span class="op">=</span> comp.groupby([<span class="st">'year'</span>,<span class="st">'roa_quintile'</span>])[<span class="st">'w_cash'</span>].mean()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>qmeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>year  roa_quintile
1980  1               0.141184
      2               0.123049
      3               0.076496
      4               0.073829
      5               0.123347
                        ...   
2020  1               0.476157
      2               0.158032
      3               0.115881
      4               0.156380
      5               0.248309
Name: w_cash, Length: 205, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>qmeans.unstack(<span class="st">'roa_quintile'</span>).plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It looks like the strong positive trend in cash holdings is only there for firms with the lowest profitability.</p>
<section id="multi-dimensional-bins" class="level2">
<h2 class="anchored" data-anchor-id="multi-dimensional-bins">Multi-dimensional bins</h2>
<p>In the example below, we redo this analysis, but this time, to judge which firm goes into which ROA bin, we compare profitability levels only amongst firms in a given year (and we do this for all years).</p>
<p>To do this, we need to use the <code>.transform()</code> function we introduced in the last lecture. We supply <code>pd.qcut</code> as a parameter to <code>.transform()</code>.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> myq(x, myq<span class="op">=</span><span class="dv">5</span>, mylabels<span class="op">=</span><span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>)):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.qcut(x,q<span class="op">=</span>myq,labels<span class="op">=</span>mylabels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'roa_q2'</span>] <span class="op">=</span> comp.groupby(<span class="st">'year'</span>)[<span class="st">'roa'</span>].transform(myq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'roa_q'</span>] <span class="op">=</span> comp.groupby(<span class="st">'year'</span>)[<span class="st">'roa'</span>].transform(<span class="kw">lambda</span> x: pd.qcut(x, q<span class="op">=</span><span class="dv">5</span>, labels <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the <code>lambda x</code> tells Python that, what follows after it (i.e.&nbsp;pd.qcut) should be seen as a function of x. So the line of code above splits the “roa” data in years, then, it takes the roa data each year, calls it “x” and then supplies it as an input to the <code>pd.qcut()</code> function. That function uses that roa information to split firms into quintiles (q=5) based on how their roa ranks amongst all other firms that year. These quintiles are given names 1 through 5 (labels = range(1,6)), and stored in a new column called “roa_q” inside the “comp” dataframe.</p>
<p>Let’s take a look at these quintile, as well as the ones we created in the prior section, and the roa levels themselves:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>comp[[<span class="st">'roa'</span>,<span class="st">'roa_quintile'</span>,<span class="st">'roa_q'</span>,<span class="st">'roa_q2'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">roa</th>
<th data-quarto-table-cell-role="th">roa_quintile</th>
<th data-quarto-table-cell-role="th">roa_q</th>
<th data-quarto-table-cell-role="th">roa_q2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">188730</td>
<td>-0.345154</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188550</td>
<td>0.054648</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188566</td>
<td>0.026506</td>
<td>3</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188567</td>
<td>0.046187</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188568</td>
<td>0.065069</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493016</td>
<td>-0.029779</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493017</td>
<td>-0.068448</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493020</td>
<td>-0.032821</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">493021</td>
<td>-0.025125</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">493024</td>
<td>0.013826</td>
<td>3</td>
<td>4</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>237017 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>comp[<span class="st">'roa_q'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>1    47310
5    47301
2    47289
4    47289
3    47283
Name: roa_q, dtype: int64</code></pre>
</div>
</div>
<p>Now we recalculate cash holding trends separately for each ROA bin, using these new bins:</p>
<div class="cell" data-scrolled="true" data-execution_count="34">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>comp.groupby([<span class="st">'year'</span>,<span class="st">'roa_q'</span>])[<span class="st">'w_cash'</span>].mean().unstack(<span class="st">'roa_q'</span>).plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lecture14_conditional_stats_applied_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This looks very similar to what we found in the prior section: the result that “firms seem to be holding a lot more cash now” holds only for firms with the lowest profitability. What do you think could account for these findings?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/github\.com\/ionmihai\/ionmihai\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>